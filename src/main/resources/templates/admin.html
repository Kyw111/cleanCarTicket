<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="./js/gasStation.js"></script>
    <title>관리자 페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
<body>

<h3>나의 주유소 목록</h3>

<ol class="list-group list-group-numbered" id="gas-station-list"></ol>

<button type="button" class="btn btn-outline-primary" onclick="openCreateForm()">추가</button>

<form id="createForm" class="invisible">
    <div class="mb-3">
        <label for="gas-station-name" class="col-form-label">주유소명</label>
        <input type="text" class="form-control" id="gas-station-name">
    </div>
    <div class="mb-3">
        <label for="gas-station-address" class="col-form-label">주유소 주소</label>
        <textarea class="form-control" id="gas-station-address"></textarea>
    </div>
    <div class="mb-3">
        <label for="clean-Car-Free-Period" class="col-form-label">무료세차권 유효기간</label>
        <textarea class="form-control" id="clean-Car-Free-Period"></textarea>
    </div>
    <button type="button" class="btn btn-primary" id="save-gas-station-btn" onclick="openCreateForm(); ">추가하기</button>
</form>

<script>
    const reqUrl = "http://localhost:8080/gas-station";
    fetch(reqUrl)
    .then(response => response.json())
    .then((data) => {
        let content = data.content;
        const ulTag = document.getElementById("gas-station-list");

        for(var i = 0; i < content.length; i++){

            const li = document.createElement("li");
            const gasStationDiv = document.createElement("div");
            const gasStationNameDiv = document.createElement("div");
            const a = document.createElement("a");

            a.setAttribute('id','gas-station');
            a.setAttribute('name', content[i].gasStationId);
            a.setAttribute('href', 'http://localhost:8080/map/'+content[i].gasStationId);

            li.setAttribute('class', 'list-group-item d-flex justify-content-between align-items-start');
            gasStationDiv.setAttribute('class', 'ms-2 me-auto');
            gasStationNameDiv.setAttribute('class', 'fw-bold');

            a.append(content[i].gasStationName);
            gasStationNameDiv.append(a);
            gasStationDiv.append(gasStationNameDiv);
            li.append(gasStationDiv);
            ulTag.append(li);
        }
    });

    const createBtn = document.getElementById('save-gas-station-btn');
    createBtn.addEventListener('click', () => {

    const postContent = {
        gasStationName : document.getElementById('gas-station-name').value,
        gasStationAddress : document.getElementById('gas-station-address').value,
        cleanCarFreePeriod : document.getElementById('clean-Car-Free-Period').value
    };

    const olTag = document.getElementById('gas-station-list');
    const li = document.createElement("li");
    const gasStationDiv = document.createElement("div");
    const gasStationNameDiv = document.createElement("div");
    const a = document.createElement("a");
    const postReqUrl = "http://localhost:8080/gas-station";
    fetch(postReqUrl, {
            method : "POST",
            body : JSON.stringify(postContent),
            headers : {
                "Content-Type" : "application/json"
            }
        })
        .then(response => response.json())
        .then((data) => {

            li.setAttribute('class', 'list-group-item d-flex justify-content-between align-items-start'),
            gasStationDiv.setAttribute('class', 'ms-2 me-auto'),
            gasStationNameDiv.setAttribute('class', 'fw-bold'),

            a.setAttribute('id', 'gas-station'),
            a.setAttribute('href', 'http://localhost:8080/map/' + data.gasStationId),

            a.append(postContent.gasStationName),
            gasStationNameDiv.append(a),
            gasStationDiv.append(gasStationNameDiv),
            li.append(gasStationDiv),
            olTag.append(li)

            if (data.cleanCarFreePeriod === 0) alert(`무료 세차권 이용 기간을 입력하지 않아 이용 기간이 ${data.cleanCarFreePeriod}일 로 설정되었습니다. 상세화면에서 수정할 수 있습니다.`)
        });
    });

function openCreateForm(){
    const visibleStatus = document.getElementById('createForm').className;
    if(visibleStatus === 'visible') document.getElementById('createForm').className = 'invisible';
    else document.getElementById('createForm').className = 'visible';
}

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>
